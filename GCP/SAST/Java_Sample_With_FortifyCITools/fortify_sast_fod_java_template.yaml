- name: 'fortifydocker/fortify-ci-tools:latest'
  entrypoint: bash
  args: 
    - -c
    - |
       fod_api_url='https://api.'`echo "$$FOD_BASEURL" | awk -F/ '{print $3}'`
       scancentral package -o sourcecode.zip --build-tool mvn
       java -jar /opt/Fortify/FodUpload/FoDUpload.jar -ac $$FOD_USER $$FOD_PWD -rid $$FOD_RELEASE_ID -purl $$FOD_BASEURL -aurl $fod_api_url -tc $$FOD_TENANT -z sourcecode.zip -ep 2 -rp 2 -pp 2 
  secretEnv: ['FOD_USER', 'FOD_PWD'] 
  env:
    - 'FOD_BASEURL=https://ams.fortify.com' 
    - 'FOD_RELEASE_ID=${_FOD_RELEASE_ID}' 
    - 'FOD_TENANT=${_FOD_TENANT}' 
  id: 'fortify-static-scan'
  waitFor: ['build-image-github-fod']
availableSecrets:
  secretManager:
  - versionName: projects/625435511991/secrets/fod_pwd/versions/1
    env: 'FOD_PWD'
  - versionName: projects/625435511991/secrets/fod_user/versions/1
    env: 'FOD_USER'